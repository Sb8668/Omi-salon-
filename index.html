<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OMI SALON</title>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
  import { getFirestore, collection, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-firestore.js";
  import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-auth.js";

  // --- Firebase Configuration ---
  const firebaseConfig = {
    apiKey: "AIzaSyAGu894r9r051gFjdVC6OGM361oWUbVD0",
    authDomain: "omi-salon.firebaseapp.com",
    projectId: "omi-salon",
    storageBucket: "omi-salon.firebasestorage.app",
    messagingSenderId: "940217697993",
    appId: "1:940217697993:web:c30ed53de67cf17507af18",
    measurementId: "G-7GRXZEY934"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  // Owner Details
  const OWNER_NAME = "Omkar Mane";
  const OWNER_MOBILE = "919145627957";
  const ADMIN_PASSWORD = "omi123";
  const services = ["Kes Cutting","Daadhi (Shaving)","Cutting + Daadhi","Hair Color","Facial","Massage"];

  let user = null;
  signInAnonymously(auth);
  onAuthStateChanged(auth, u => user = u);

  window.appData = {
    bookedSlots: {},
    formData: { name:'', phone:'', service:'', date: new Date().toISOString().split('T')[0], time:'' }
  };

  // Load booked slots for today
  function loadSlots(date){
    if(!user) return;
    const q = collection(db, 'artifacts', 'omi-salon-gold-3d', 'public', 'data', `bookings_${date}`);
    onSnapshot(q, snapshot=>{
      const slots = {};
      snapshot.forEach(d=>slots[d.id]={id:d.id,...d.data()});
      window.appData.bookedSlots = slots;
      renderSlots();
    });
  }

  function bookSlot(e){
    e.preventDefault();
    const fd = window.appData.formData;
    const slotId = fd.time.replace(':','');
    if(window.appData.bookedSlots[slotId]){
      alert("हा slot आधीच book झाला आहे!");
      return;
    }
    const docRef = doc(db, 'artifacts', 'omi-salon-gold-3d', 'public', 'data', `bookings_${fd.date}`, slotId);
    setDoc(docRef, {...fd, timestamp:new Date().getTime()})
    .then(()=>{
      const ownerMsg = `नमस्कार ${OWNER_NAME}, \n\n${fd.name} ने booking केली आहे.\nसेवा: ${fd.service}\nतारीख: ${fd.date}\nवेळ: ${fd.time}`;
      window.open(`https://wa.me/${OWNER_MOBILE}?text=${encodeURIComponent(ownerMsg)}`, '_blank');
      const customerMsg = `नमस्कार ${fd.name}, \n\nतुमची booking ${fd.service} साठी ${fd.date} रोजी ${fd.time} वाजता confirm झाली आहे.\nOMI SALON`;
      window.open(`https://wa.me/91${fd.phone}?text=${encodeURIComponent(customerMsg)}`, '_blank');
      alert("Booking Confirmed!");
      window.appData.formData = { name:'', phone:'', service:'', date:fd.date, time:'' };
      renderForm();
    })
    .catch(err=>alert("Booking मध्ये त्रुटी आली!"));
  }

  function renderSlots(){
    const slotContainer = document.getElementById('slots');
    slotContainer.innerHTML='';
    const slots = Object.values(window.appData.bookedSlots).sort((a,b)=>a.time.localeCompare(b.time));
    if(slots.length===0){ slotContainer.innerHTML="<p>आज अजून कोणतीही booking नाही.</p>"; return; }
    slots.forEach(b=>{
      const div = document.createElement('div');
      div.textContent = `${b.time} - ${b.name} (${b.service})`;
      slotContainer.appendChild(div);
    });
  }

  function renderForm(){
    document.getElementById('name').value = window.appData.formData.name;
    document.getElementById('phone').value = window.appData.formData.phone;
    document.getElementById('service').value = window.appData.formData.service;
    document.getElementById('date').value = window.appData.formData.date;
    document.getElementById('time').value = window.appData.formData.time;
  }

  function setFormValue(field,val){ window.appData.formData[field]=val; }

  function checkAdmin(){
    const pass = prompt("Admin Password?");
    if(pass===ADMIN_PASSWORD){
      alert("Admin Access Granted!");
      document.getElementById('adminPanel').style.display='block';
    }else alert("पासवर्ड चुकीचा!");
  }

  window.onload = ()=>{
    loadSlots(window.appData.formData.date);
    renderForm();
    document.getElementById('date').addEventListener('change', e=>{ window.appData.formData.date=e.target.value; loadSlots(e.target.value); });
  };
</script>
<style>
  body{margin:0;font-family:sans-serif;background:linear-gradient(45deg,#C5A059,#222);}
  header{padding:20px;text-align:center;color:white;font-weight:bold;font-size:24px;}
  main{display:flex;flex-wrap:wrap;gap:30px;padding:20px;justify-content:center;}
  .form, .slots, .admin{background:white/10;padding:20px;border-radius:15px;color:white;width:300px;}
  input, select, button{width:100%;margin:5px 0;padding:8px;border-radius:8px;border:none;}
  button{background:#C5A059;color:black;font-weight:bold;cursor:pointer;}
  button:hover{transform:scale(1.05);transition:0.3s;}
  #adminPanel{display:none;}
</style>
</head>
<body>
<header>OMI SALON - Premium Booking</header>
<main>
  <div class="form">
    <h3>Booking Form</h3>
    <form onsubmit="bookSlot(event)">
      <input type="text" id="name" placeholder="तुमचं नाव" oninput="setFormValue('name',this.value)" required>
      <input type="tel" id="phone" placeholder="मोबाइल नंबर" oninput="setFormValue('phone',this.value)" required>
      <select id="service" oninput="setFormValue('service',this.value)" required>
        <option value="">सेवा निवडा</option>
        <option value="Kes Cutting">Kes Cutting</option>
        <option value="Daadhi (Shaving)">Daadhi (Shaving)</option>
        <option value="Cutting + Daadhi">Cutting + Daadhi</option>
        <option value="Hair Color">Hair Color</option>
        <option value="Facial">Facial</option>
        <option value="Massage">Massage</option>
      </select>
      <input type="date" id="date" oninput="setFormValue('date',this.value)" required>
      <input type="time" id="time" oninput="setFormValue('time',this.value)" required>
      <button type="submit">Book Now</button>
    </form>
  </div>
  <div class="slots" id="slots">
    <h3>Today's Bookings</h3>
  </div>
  <div class="admin">
    <h3>Admin Panel</h3>
    <button onclick="checkAdmin()">Login as Admin</button>
    <div id="adminPanel">
      <p>Admin Access Granted!</p>
      <p>Owner: Omkar Mane</p>
      <p>WhatsApp: 919145627957</p>
      <p>Developed by Sourabh</p>
    </div>
  </div>
</main>
</body>
</html>
